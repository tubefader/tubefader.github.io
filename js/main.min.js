var main={element:document.querySelector("main"),was:null,exists:function(){if(arguments.length>0){var e="string"==typeof arguments[0]?window[arguments[0]]:arguments[0];if("object"!=typeof e||null===e)return!1;for(var t=1;t<arguments.length;t++)if(e=e[arguments[t]],"object"!=typeof e||null===e)return!1}return!0},api:{src:"https://apis.google.com/js/api.js",key:"AIzaSyACWZUx0jw3tqKl5NVuXqxuB7siYiziPDA",stack:[],Video:function(e,t){if(Array.isArray(e)){for(var i=0;i<e.length;i++)e[i]=new main.api.Video(e[i],t);return e}this.id=e.id.videoId,this.title=e.snippet.title,this.channel=e.snippet.channelTitle,this.thumbnails=e.snippet.thumbnails,this.url="https://www.youtube.com/watch?v="+this.id,this.related=t instanceof main.api.Video?49==t.related?0:t.related+1:0,this.interval=null,this.src=function(e){if("function"==typeof e){var t=new XMLHttpRequest;t.open("GET","https://helloacm.com/api/video/?cached&video="+this.url,!0),t.onreadystatechange=function(i){if(4==t.readyState&&200==t.status){var n=JSON.parse(t.responseText);e(n.url)}},t.send()}}},"do":function(e){this.provided?e():this.stack.push(e)},get provided(){return main.exists("gapi","client","youtube")},get load(){var e=this;return function(){gapi.load("client",function(){gapi.client.load("youtube","v3",function(){gapi.client.setApiKey(e.key);for(var t=0;t<e.stack.length;t++)e.stack[t]();e.stack=[]})})}},search:function(e,t){var i=this;this["do"](function(){gapi.client.youtube.search.list({q:e,part:"snippet",type:"video",maxResults:15}).execute(function(e){main.exists(e,"result","items")&&t(new i.Video(e.result.items))})})},infos:function(e,t){var i=this;this["do"](function(){gapi.client.youtube.videos.list({id:e,part:"snippet",type:"video",maxResults:1}).execute(function(e){main.exists(e,"result","items")&&t(e.result.items.length>0?new i.Video(e.result.items[0]):null)})})},related:function(e,t){if(e instanceof this.Video){var i=this;this["do"](function(){gapi.client.youtube.search.list({relatedToVideoId:e.id,part:"snippet",type:"video",maxResults:e.related+1}).execute(function(n){if(main.exists(n,"result","items")){var s=n.result.items,o=s.length>e.related+1?e.related+1:0;s.length>0&&t(new i.Video(n.result.items[o],e))}})})}},append:function(){var e=document.createElement("script");e.async=!0,e.defer=!0,e.src=this.src,e.addEventListener("load",this.load),e.addEventListener("readystatechange",function(){"complete"===this.readyState&&this.onload()}),document.head.appendChild(e)},init:function(){this.append()}},Side:function(e,t){var i=this,n=null,s=!1,o=document.createElement("li");this.offset=-1,o.className="empty",o.appendChild(document.createTextNode("No result")),this.element=document.querySelector("."+e),this.search=this.element.querySelector(".search"),this.input=this.element.querySelector("input"),this.results=this.element.querySelector("ul"),this.video=this.element.querySelector("video"),this.progressElement=this.element.querySelector(".progress"),this.overwritten=!1,Object.defineProperties(this,{visible:{set:function(e){e?i.search.setAttribute("data-visible",""):i.search.removeAttribute("data-visible")}},keep:{get:function(){return s},set:function(e){s=!!e,e?document.body.setAttribute("data-keep",""):document.body.removeAttribute("data-keep")}},searching:{set:function(e){e?(this.input.setAttribute("data-searching",""),main.config.hidden=!0):(this.input.removeAttribute("data-searching"),main.config.hidden=!1)}},src:{get function(){return this.video.src},set:function(e){this.video.src=e}},volume:{get:function(){return this.video.volume},set:function(e){this.video.volume=e<0?0:e>1?1:e}},paused:{get:function(){return this.video.paused}},ready:{get:function(){return 4==i.video.readyState}},opposite:{get:function(){return main[t]}},poster:{set:function(e){var t=Object.keys(e);this.video.poster=e[t[t.length-1]].url}},duration:{get:function(){return this.video.duration}},currentTime:{get:function(){return this.video.currentTime}},progress:{set:function(e){this.progressElement.style.width=100*e+"%"}},active:{set:function(e){e?i.video.setAttribute("data-active",""):i.video.removeAttribute("data-active")}}}),this.url=function(e){var t=e.match(/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube\.com|youtu.be))(\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(\S+)?$/);return null!==t&&t[5]},this.clear=function(){clearTimeout(n)},this.show=function(){this.hideLater(),this.visible=!0},this.hide=function(){this.keep||(this.clear(),this.visible=!1)},this.play=function(e,t){if(e)this.video.play(),this.active=!0,this.opposite.active=!1;else{this.volume=0;var n=function(){i.play(!0),i.fade(1,t),i.video.removeEventListener("canplay",n)};this.ready?n():this.video.addEventListener("canplay",n)}},this.pause=function(e,t){e?(this.video.pause(),this.active=!1):(t="function"==typeof t?t:function(){},this.fade(0,function(){i.pause(!0),t()}))},this.fadeStep=function(e){return(e-this.volume)/main.config.fadeDuration},this.ease=function(e,t){return"ease"==main.config.ease?3*Math.pow(1-t-e,2):1},this.fade=function(e,t){t="function"==typeof t?t:function(){};var n=this.fadeStep(e),s=main.config.fadeDuration,o=0,a=null;clearInterval(i.interval),i.interval=setInterval(function(){null===a&&(a=(new Date).getTime());var r=(new Date).getTime()-a,u=r-o;r<s||i.volume!=e?u>0&&(o=r,i.volume+=n*u*i.ease(r/s,e)):(clearInterval(i.interval),t())},1)},this.load=function(e,t,n){t="function"==typeof t?t:function(){},i.poster=e.thumbnails,i.input.value=e.title,this.pause(!0),this.video.object=e,this.overwritten=!!n,main.element.setAttribute("data-init",""),e.src(function(e){i.progress=0,i.src=e,t()})},this.hideLater=function(){this.clear(),n=setTimeout(function(){i.hide()},3e3)};var a=function(e){return function(){i.load(e,function(){i.opposite.paused&&(i.play(!0),i.opposite.overwritten||main.api.related(e,function(e){i.opposite.load(e)}))},!0)}};this.result=function(e){var t=document.createElement("li"),i=document.createElement("img");i.className="thumbnail",i.src=e.thumbnails["default"].url;var n=document.createElement("div");n.className="infos";var s=document.createElement("span");s.className="title";var o=document.createElement("span");return o.className="channel",o.appendChild(document.createTextNode(e.channel)),s.appendChild(document.createTextNode(e.title)),n.appendChild(s),n.appendChild(o),t.appendChild(i),t.appendChild(n),t.video=e,t.addEventListener("mousedown",a(e)),t},this.element.addEventListener("mousemove",function(){i.show()}),this.element.addEventListener("mouseout",function(){i.hide()}),this.video.addEventListener("timeupdate",function(){i.duration-i.currentTime<=main.config.fadeDuration/1e3&&(i.pause(!1,function(){main.api.related(i.video.object,function(e){i.load(e)})}),i.opposite.play()),i.progress=i.currentTime/i.duration}),this.element.addEventListener("click",function(e){i.input.focused||(i.paused&&!i.opposite.paused?(i.play(),i.opposite.pause()):!i.paused&&i.opposite.paused?(i.opposite.play(),i.pause()):main.was&&main.was.play(!0))}),this.results.addEventListener("click",function(e){main.config.open=!1,e.stopPropagation()}),this.results.addEventListener("dblclick",function(e){e.stopPropagation()}),this.input.addEventListener("click",function(e){main.config.open=!1,e.stopPropagation()}),this.input.addEventListener("dblclick",function(e){e.stopPropagation()}),this.input.addEventListener("focus",function(){i.keep=!0,""!==i.results.innerHTML&&(i.searching=!0),i.clear(),setTimeout(function(){i.input.select()},1)}),this.input.addEventListener("blur",function(){i.keep=!1,i.searching=!1,i.hide()}),this.input.addEventListener("keydown",function(e){var t=i.results.querySelectorAll("li");if(38==e.keyCode||40==e.keyCode){38==e.keyCode?(i.offset--,i.offset<0&&(i.offset=t.length-1)):(i.offset++,i.offset>=t.length&&(i.offset=0));for(var n=t[i.offset],s=0;s<t.length;s++)t[s].removeAttribute("data-selected");n.setAttribute("data-selected","");var r=n.offsetHeight*i.offset,u=n.offsetHeight*(i.offset-1);i.results.scrollTop<r&&(i.results.scrollTop=r),i.results.scrollTop>u&&(i.results.scrollTop=u)}else if(13==e.keyCode)i.offset>=0&&i.offset<t.length&&(a(t[i.offset].video)(),this.blur());else if(27==e.keyCode)this.blur(),e.preventDefault();else if(![37,39,16].includes(e.keyCode)){var c=this;setTimeout(function(){var e=c.value;if(""===e)i.searching=!1,i.results.innerHTML="";else{var t=i.url(e);t?main.api.infos(t,function(e){i.searching=!0,i.results.innerHTML="",e?i.results.appendChild(i.result(e)):i.results.appendChild(o)}):main.api.search(e,function(e){if(i.searching=!0,i.results.innerHTML="",0===e.length)i.results.appendChild(o);else for(var t=0;t<e.length;t++)i.results.appendChild(i.result(e[t]));i.offset=-1})}},1)}})},cursor:{timeout:null,set visible(e){e?document.body.removeAttribute("data-cursor-hidden"):document.body.setAttribute("data-cursor-hidden","")},clear:function(){clearTimeout(this.timeout)},show:function(){this.hide(),this.visible=!0},hide:function(){var e=this;this.clear(),this.timeout=setTimeout(function(){e.visible=!1},3e3)},init:function(){var e=this;this.hide(),document.body.addEventListener("mousemove",function(){e.show()})}},left:null,right:null,config:{element:document.querySelector(".config"),toggler:document.querySelector(".config span"),inputs:{fadeDuration:document.querySelector("#config-fade-duration"),fadeCurve:document.querySelector("#config-fade-curve")},get open(){return null!==this.element.getAttribute("data-open")},set open(e){e?this.element.setAttribute("data-open",""):this.element.removeAttribute("data-open")},set hidden(e){e?this.element.setAttribute("data-hidden",""):this.element.removeAttribute("data-hidden")},fadeDuration:1e4,fadeCurve:"ease",init:function(){var e=this;this.element.addEventListener("click",function(e){e.stopPropagation()}),this.toggler.addEventListener("click",function(){e.open=!e.open}),this.inputs.fadeDuration.addEventListener("keydown",function(){var t=this;setTimeout(function(){var i=parseFloat(t.value);isNaN(i)||(e.fadeDuration=1e3*i)},1)}),this.inputs.fadeDuration.addEventListener("change",function(){this.value=e.fadeDuration/1e3}),this.inputs.fadeCurve.addEventListener("change",function(){e.fadeCurve=this.value}),window.addEventListener("click",function(){e.open=!1}),window.addEventListener("keydown",function(t){27==t.keyCode&&e.open&&(e.open=!1,t.preventDefault())})}},init:function(){var e=this;this.api.init(),this.cursor.init(),this.config.init(),this.left=new this.Side("left","right"),this.right=new this.Side("right","left"),window.addEventListener("keydown",function(t){32!=t.keyCode||e.left.input.focused||e.right.input.focused||(e.left.paused&&e.right.paused?e.was?e.was.play(!0):e.left.play(!0):(e.was=e.left.paused?e.right:e.left,e.left.pause(!0),e.right.pause(!0)))})}};main.init();